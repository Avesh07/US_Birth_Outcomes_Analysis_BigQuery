SELECT
  SUM(Births),
  County_of_Residence
FROM
  bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
GROUP BY
  County_of_Residence
ORDER BY
  SUM(Births) DESC
LIMIT
  10;

## Los Angeles County, CA has observed the most newborns during 2016-2018, with a total of 350313 in 3 years.##


SELECT
  ROUND(AVG(Ave_Pre_pregnancy_BMI),2) AS Avg_prepregnancy_BMI,
  County_of_Residence AS County
FROM
  bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
GROUP BY
  County
ORDER BY
  Avg_prepregnancy_BMI ASC
LIMIT 
  10;

## County with the lowest pre pregnancy BMI is New York County, NY with an average of 23.9, followed by San Francisco County, CA with an average of 24.01.##

SELECT
  ROUND(AVG(Ave_Number_of_Prenatal_Wks),2) AS Avg_Prenatal_Weeks,
  County_of_Residence AS County
FROM
  bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
GROUP BY
  County
ORDER BY
  Avg_Prenatal_Weeks ASC
LIMIT 
  10;

## County with the lowest prenatal weeks is Nueces County, TX with an average of 8.93, followed by Cochise County, AZ with an average of 9.05.##

SELECT 
  ROUND(AVG(Ave_Birth_Weight_gms),2)
FROM 
  bigquery-public-data.sdoh_cdc_wonder_natality.county_natality;

## Average birth weight through the period of last three years is 3275.73.##

WITH y2018 AS
( SELECT
    ROUND(SUM(Births),2) AS births,
    EXTRACT (YEAR FROM Year) AS year2018
  FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
  WHERE
    Year IN (DATE "2018-01-01")
  GROUP BY
    Year),
  y2017 AS
( SELECT
    ROUND(SUM(Births),2) AS births,
    EXTRACT (YEAR FROM Year) AS year2017
  FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
  WHERE
    Year IN (DATE "2017-01-01")
  GROUP BY
    Year),
  y2016 AS
( SELECT
    ROUND(SUM(Births),2) AS births,
    EXTRACT (YEAR FROM Year) AS year2016
  FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
  WHERE
    Year IN (DATE "2016-01-01")
  GROUP BY
    Year)
SELECT
  ROUND((y2018.births - y2017.births)/y2017.births*100,2) AS YOY2018,
  ROUND((y2017.births - y2016.births)/y2016.births*100,2) AS YOY2017
FROM
  y2018
JOIN
  y2017
ON
  1=1
JOIN
  y2016
ON
  1=1;

## YoY births: 2017 vs 2016 = –2.29%; 2018 vs 2017 = –1.65%. ##

WITH y2018 AS
  (SELECT
    ROUND(AVG(Ave_Birth_Weight_gms),2) AS birthweight,
    EXTRACT (YEAR FROM Year) AS year2018
   FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
   WHERE
    Year IN (DATE "2018-01-01")
   GROUP BY
    Year),
  y2017 AS
  (SELECT
    ROUND(AVG(Ave_Birth_Weight_gms),2) AS birthweight,
    EXTRACT (YEAR FROM Year) AS year2017
   FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
   WHERE
    Year IN (DATE "2017-01-01")
   GROUP BY
    Year),
  y2016 AS
    (SELECT
    ROUND(AVG(Ave_Birth_Weight_gms),2) AS birthweight,
    EXTRACT (YEAR FROM Year) AS year2016
   FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
   WHERE
    Year IN (DATE "2016-01-01")
   GROUP BY
    Year)
SELECT
  ROUND((y2018.birthweight - y2017.birthweight)/y2017.birthweight*100,2) AS YOY2018,
  ROUND((y2017.birthweight - y2016.birthweight)/y2016.birthweight*100,2) AS YOY2017
FROM
  y2018
JOIN
  y2017
ON
  1=1
JOIN
  y2016
ON
  1=1;

## YoY birthweight change: 2017 vs 2016 = –0.14%; 2018 vs 2017 = –0.03%. ##

WITH below_by_year AS  
  (SELECT
    2018 AS Year,
    County_of_Residence,
    ROUND(AVG(Ave_Birth_Weight_gms), 2) AS county_avg
   FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
   WHERE
    Year IN (DATE "2018-01-01")
   GROUP BY
    Year,
    County_of_Residence
   HAVING
    county_avg < 
  (SELECT
    ROUND(AVG(Ave_Birth_Weight_gms), 2) AS national_avg
   FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
   WHERE
    Year IN (DATE "2018-01-01"))

UNION ALL

  SELECT
    2017 AS Year,
    County_of_Residence,
    ROUND(AVG(Ave_Birth_Weight_gms), 2) AS county_avg
  FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
  WHERE
    Year IN (DATE "2017-01-01")
  GROUP BY
    Year,
    County_of_Residence
  HAVING
    county_avg < 
  (SELECT
    ROUND(AVG(Ave_Birth_Weight_gms), 2) AS national_avg
   FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
   WHERE
    Year IN (DATE "2017-01-01"))

UNION ALL

  SELECT
    2016 AS Year,
    County_of_Residence,
    ROUND(AVG(Ave_Birth_Weight_gms), 2) AS county_avg
  FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
  WHERE
    Year IN (DATE "2016-01-01")
  GROUP BY
    Year,
    County_of_Residence
  HAVING
    county_avg < 
  (SELECT
    ROUND(AVG(Ave_Birth_Weight_gms), 2) AS national_avg
   FROM
    bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
   WHERE
    Year IN (DATE "2016-01-01"))
   ORDER BY
    Year,
    county_avg DESC)

SELECT 
  County_of_Residence
FROM 
  below_by_year
GROUP BY 
  County_of_Residence
HAVING 
  COUNT(DISTINCT year) = 3
ORDER BY 
  County_of_Residence;

## There are 257 counties across The US that has consistent average birth weight below the national average in the year 2016, 2017 and 2018. ##

SELECT
  Ave_Age_of_Mother as Average_Mother_Age,
  Ave_Birth_Weight_gms
FROM
  bigquery-public-data.sdoh_cdc_wonder_natality.county_natality
GROUP BY
  Average_Mother_Age,
  Ave_Birth_Weight_gms
ORDER BY
  Average_Mother_Age DESC

## It is observed that older moms tends to give birth to healthier babies. ##


